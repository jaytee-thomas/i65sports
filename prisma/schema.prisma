generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  username  String     @unique
  role      Role       @default(USER)
  createdAt DateTime   @default(now())
  clerkId   String?    @unique
  comments  Comment[]
  followers Follow[]   @relation("Followers")
  following Follow[]   @relation("Following")
  takes     HotTake[]
  reactions Reaction[]
}

model HotTake {
  id        String     @id @default(cuid())
  authorId  String
  kind      TakeKind   @default(VIDEO)
  title     String?
  videoUrl  String?
  audioUrl  String?
  textBody  String?
  duration  Int?
  sport     String?
  league    String?
  tags      String[]
  createdAt DateTime   @default(now())
  status    TakeStatus @default(PUBLISHED)
  
  // VENUE FEATURES (merged from FanReel)
  recordedAtVenue Boolean  @default(false)
  gameId          String?
  venueLat        Float?
  venueLng        Float?
  venueName       String?
  shotAt          DateTime? // When recorded (useful for sorting venue takes)
  
  // Video metadata (merged from FanReel)
  thumbUrl String?
  width    Int?
  height   Int?
  
  // Relations
  comments  Comment[]
  author    User       @relation(fields: [authorId], references: [id])
  game      Game?      @relation(fields: [gameId], references: [id])
  reactions Reaction[]
  
  // Indexes for performance
  @@index([createdAt])
  @@index([recordedAtVenue, createdAt])
  @@index([gameId, shotAt])
  @@index([league, createdAt])
}

model Reaction {
  id        String   @id @default(cuid())
  takeId    String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  take      HotTake  @relation(fields: [takeId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@unique([takeId, userId, emoji])
}

model Comment {
  id        String   @id @default(cuid())
  authorId  String
  takeId    String
  body      String
  createdAt DateTime @default(now())
  author    User     @relation(fields: [authorId], references: [id])
  take      HotTake  @relation(fields: [takeId], references: [id], onDelete: Cascade)
  
  @@index([takeId, createdAt])
}

model Follow {
  id         String   @id @default(cuid())
  followerId String
  followeeId String
  createdAt  DateTime @default(now())
  followee   User     @relation("Followers", fields: [followeeId], references: [id])
  follower   User     @relation("Following", fields: [followerId], references: [id])

  @@unique([followerId, followeeId])
}

model Game {
  id        String    @id @default(cuid())
  league    String
  homeTeam  String
  awayTeam  String
  venue     String?
  startTime DateTime
  seasonKey String?
  createdAt DateTime  @default(now())
  takes     HotTake[] // Changed from 'reels' to 'takes'

  @@index([league, startTime])
  @@index([homeTeam, awayTeam, startTime])
}

model Venue {
  id        String   @id @default(cuid())
  name      String
  city      String
  state     String
  latitude  Float
  longitude Float
  capacity  Int?
  sport     String?
  team      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name, city])
  @@index([latitude, longitude])
  @@map("venues")
}

enum Role {
  USER
  COLUMNIST
  EDITOR
  ADMIN
}

enum TakeKind {
  VIDEO
  AUDIO
  TEXT
}

enum TakeStatus {
  PUBLISHED
  FLAGGED
  REMOVED
}

// REMOVED: Article, FanReel, Reply, RecordingDraft models
// REMOVED: ReplyKind, ReelStatus, RecordingStatus enums
